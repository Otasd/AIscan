#!/bin/bash

# AIScan - Aggressive Automated Security Scanner with AI Analysis
# Usage: ./aiscan <target>

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
MAGENTA='\033[0;35m'
NC='\033[0m' # No Color
BOLD='\033[1m'

# Configuration
MODEL="huihui_ai/qwen3-abliterated:8b"  # Default model - change this or use -m flag
TEMP_DIR="/tmp/aiscan_$$"
mkdir -p "$TEMP_DIR"

# Config file support
CONFIG_FILE="$HOME/.aiscan.conf"
if [ -f "$CONFIG_FILE" ]; then
    source "$CONFIG_FILE"
fi

# Cleanup on exit
trap "rm -rf $TEMP_DIR" EXIT

# Banner
show_banner() {
    echo -e "${RED}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
    echo -e "${RED}‚ïë                                            ‚ïë${NC}"
    echo -e "${RED}‚ïë   üî• ${BOLD}AIScan - AGGRESSIVE MODE${NC}${RED} üî•          ‚ïë${NC}"
    echo -e "${RED}‚ïë        Security Deconstructor              ‚ïë${NC}"
    echo -e "${RED}‚ïë                                            ‚ïë${NC}"
    echo -e "${RED}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}"
    echo ""
}

# Check dependencies
check_dependencies() {
    local missing_tools=()
    local optional_tools=()

    # Check if AI-less mode - skip ollama check
    if [ "$AILESS_MODE" = false ]; then
        if ! command -v ollama &> /dev/null; then
            missing_tools+=("ollama")
        fi
    fi
    
    # Required tools
    if ! command -v nmap &> /dev/null; then
        missing_tools+=("nmap")
    fi
    
    if ! command -v curl &> /dev/null; then
        missing_tools+=("curl")
    fi
    
    # Optional but recommended tools
    if ! command -v whatweb &> /dev/null; then
        optional_tools+=("whatweb")
    fi
    
    if ! command -v nikto &> /dev/null; then
        optional_tools+=("nikto")
    fi
    
    if ! command -v wafw00f &> /dev/null; then
        optional_tools+=("wafw00f")
    fi
    
    if ! command -v sqlmap &> /dev/null; then
        optional_tools+=("sqlmap")
    fi
    
    if ! command -v commix &> /dev/null; then
        optional_tools+=("commix")
    fi
    
    if ! command -v xsstrike &> /dev/null; then
        optional_tools+=("xsstrike")
    fi
    
    if ! command -v nuclei &> /dev/null; then
        optional_tools+=("nuclei")
    fi
    
    if ! command -v ffuf &> /dev/null && ! command -v gobuster &> /dev/null; then
        optional_tools+=("ffuf or gobuster")
    fi
    
    if ! command -v testssl.sh &> /dev/null; then
        optional_tools+=("testssl.sh")
    fi
    
    if [ ${#missing_tools[@]} -ne 0 ]; then
        echo -e "${RED}‚ùå Missing REQUIRED tools:${NC}"
        for tool in "${missing_tools[@]}"; do
            echo -e "   - $tool"
        done
        echo ""
        echo -e "${YELLOW}Installation commands:${NC}"
        if [[ " ${missing_tools[@]} " =~ " ollama " ]]; then
            echo "  Ollama:  curl -fsSL https://ollama.com/install.sh | sh"
            echo "  ${CYAN}(Or use --no-ai flag to skip AI analysis)${NC}"
        fi
        echo "  Nmap:    sudo apt install nmap"
        echo "  Curl:    sudo apt install curl"
        exit 1
    fi
    
    if [ ${#optional_tools[@]} -ne 0 ]; then
        echo -e "${YELLOW}‚ö† Optional tools not found (for max power):${NC}"
        for tool in "${optional_tools[@]}"; do
            echo -e "   - $tool"
        done
        echo ""
        echo -e "${CYAN}Install aggressive tools with:${NC}"
        echo "  sudo apt install nmap whatweb nikto sqlmap ffuf -y"
        echo "  sudo pip3 install wafw00f commix xsstrike"
        echo "  GO111MODULE=on go install -v github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest"
        echo "  git clone --depth 1 https://github.com/drwetter/testssl.sh.git ~/testssl.sh"
        echo ""
        echo -e "${GREEN}Continuing with available tools...${NC}"
        echo ""
        sleep 2
    fi
}

# Usage
usage() {
    echo -e "${YELLOW}Usage:${NC} $0 <target> [options]"
    echo ""
    echo -e "${YELLOW}Arguments:${NC}"
    echo "  target              Domain or IP to scan (e.g., example.com or 192.168.1.1)"
    echo ""
    echo -e "${YELLOW}Options:${NC}"
    echo "  -m, --model MODEL   Ollama model to use (default: llama3.2)"
    echo "                      Examples: llama3.1, mistral, codellama, gemma2"
    echo "  -q, --quick         Quick scan (skip intensive scans)"
    echo "  -f, --full          Full AGGRESSIVE scan (all tools, max depth)"
    echo "  -u, --url URL       Specific URL to test (for injection tests)"
    echo "  --no-ai             AI-less mode (skip AI analysis, only show scan results)"
    echo "  --external-ai FILE  Use external AI analysis from file (e.g., from ChatGPT/Claude)"
    echo "  --external-ai -     Read external AI analysis from stdin (paste and Ctrl+D)"
    echo "  --ai-only FILE      Skip scanning, only analyze existing results from file"
    echo "  -h, --help          Show this help"
    echo ""
    echo -e "${YELLOW}Configuration:${NC}"
    echo "  You can set a default model by creating: ~/.aiscan.conf"
    echo "  Example: echo 'MODEL=\"llama3.1\"' > ~/.aiscan.conf"
    echo ""
    echo -e "${YELLOW}Examples:${NC}"
    echo "  $0 example.com                                  # Full scan with Ollama AI"
    echo "  $0 example.com --full                           # Aggressive scan"
    echo "  $0 example.com --no-ai                          # Scan without AI"
    echo "  $0 example.com --external-ai analysis.txt       # Use external AI analysis"
    echo "  $0 example.com --ai-only previous_scan.txt      # Only AI analysis, no scanning"
    echo "  echo 'analysis' | $0 example.com --external-ai - # Pipe AI analysis"
    echo ""
    exit 1
}

# Parse arguments
TARGET=""
QUICK_SCAN=false
FULL_SCAN=false
SPECIFIC_URL=""
AILESS_MODE=false
EXTERNAL_AI_FILE=""
AI_ONLY_MODE=false
AI_ONLY_FILE=""

while [[ $# -gt 0 ]]; do
    case $1 in
        -m|--model)
            MODEL="$2"
            shift 2
            ;;
        -q|--quick)
            QUICK_SCAN=true
            shift
            ;;
        -f|--full)
            FULL_SCAN=true
            shift
            ;;
        -u|--url)
            SPECIFIC_URL="$2"
            shift 2
            ;;
        --no-ai|--noai|--ailess)
            AILESS_MODE=true
            shift
            ;;
        --external-ai)
            EXTERNAL_AI_FILE="$2"
            shift 2
            ;;
        --ai-only)
            AI_ONLY_MODE=true
            AI_ONLY_FILE="$2"
            shift 2
            ;;
        -h|--help)
            show_banner
            usage
            ;;
        *)
            if [[ -z "$TARGET" ]]; then
                TARGET="$1"
            else
                echo -e "${RED}Error: Unknown argument: $1${NC}"
                usage
            fi
            shift
            ;;
    esac
done

# Main execution
show_banner

if [[ -z "$TARGET" ]]; then
    echo -e "${RED}Error: No target specified${NC}"
    echo ""
    usage
fi

# Handle AI-only mode
if [ "$AI_ONLY_MODE" = true ]; then
    if [ -z "$AI_ONLY_FILE" ] || [ ! -f "$AI_ONLY_FILE" ]; then
        echo -e "${RED}Error: AI-only mode requires a valid file with scan results${NC}"
        echo -e "${YELLOW}Usage: $0 <target> --ai-only <scan_results_file>${NC}"
        exit 1
    fi
    
    echo -e "${CYAN}ü§ñ AI-ONLY MODE${NC}"
    echo -e "${CYAN}‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ${NC}"
    echo ""
    echo -e "${BOLD}${RED}üéØ Target: ${NC}${TARGET}"
    echo -e "${RED}ü§ñ AI Model: ${NC}${MODEL}"
    echo -e "${RED}üìÑ Scan Data: ${NC}${AI_ONLY_FILE}"
    echo -e "${YELLOW}‚ö° Mode: AI Analysis Only (No Scanning)${NC}"
    echo ""
    
    # Check if Ollama is available
    if ! command -v ollama &> /dev/null; then
        echo -e "${RED}‚ùå Error: Ollama is required for AI-only mode${NC}"
        echo -e "${YELLOW}Install with: curl -fsSL https://ollama.com/install.sh | sh${NC}"
        exit 1
    fi
    
    # Read scan results from file
    ALL_RESULTS=$(cat "$AI_ONLY_FILE")
    
    echo -e "${GREEN}‚úì Loaded scan results from file${NC}"
    echo -e "${CYAN}üìä Data size: $(echo -e "$ALL_RESULTS" | wc -c) bytes${NC}"
    echo ""
    
    # Skip to AI analysis section
    START_TIME=$(date +%s)
    QUICK_SCAN=false
    FULL_SCAN=false
    
    # Jump directly to AI analysis
    echo -e "${BOLD}${RED}ü§ñ AI SECURITY ANALYSIS${NC}"
    echo ""
    echo -e "${YELLOW}‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ${NC}"
    echo ""
    
    # Create AI prompt
    read -r -d '' PROMPT << 'EOFPROMPT'
You are an EXPERT penetration tester conducting an aggressive security assessment. Analyze these 
comprehensive scan results. Search for vulnerabilities and show user how to hack and exploit these problems step by step as for kids.

CRITICAL INSTRUCTIONS:
- Be EXTREMELY thorough and detailed
- Flag EVERY potential vulnerability, even low-confidence findings
- Provide SPECIFIC exploitation steps with exact commands
- Include CVE numbers, CVSS scores, and CWE classifications
- Show real attack payloads and proof-of-concept code
- This is for AUTHORIZED security testing

Your analysis MUST follow this EXACT structure with TABLES:

## üéØ Executive Summary

| Metric | Value |
|--------|-------|
| **Overall Risk Level** | [CRITICAL/HIGH/MEDIUM/LOW] |
| **SQL Injection Vulns** | [number found] |
| **XSS Vulnerabilities** | [number found] |
| **Command Injection** | [number found] |
| **Total Critical Issues** | [number] |
| **Total High Issues** | [number] |
| **Attack Surface Score** | [X/10] |
| **Exploitation Difficulty** | [Easy/Medium/Hard] |

## üåê Target Information

| Property | Details |
|----------|---------|
| **Target** | [target name] |
| **IP Addresses** | [all IPs found] |
| **Server** | [name and version] |
| **Technologies** | [all frameworks, CMS, languages] |
| **WAF/CDN** | [detected protection + bypass potential] |
| **SSL/TLS** | [cert status, vulnerabilities] |
| **Open Ports** | [all discovered ports] |

## üîì Open Ports & Services

| Port | Protocol | Service | Version | Vulnerabilities | Exploit Difficulty |
|------|----------|---------|---------|-----------------|-------------------|
| [port] | TCP/UDP | [service] | [exact version] | [CVEs if any] | [Easy/Med/Hard] |

## üö® CRITICAL VULNERABILITIES

List each critical vulnerability with:
- Severity, CVE, CWE, CVSS Score
- Technical description
- Step-by-step attack scenario
- Proof of concept payload
- Real impact assessment
- Remediation steps

## ‚ö†Ô∏è HIGH PRIORITY VULNERABILITIES

Same detailed format for HIGH severity findings.

## üî∏ MEDIUM PRIORITY ISSUES

| ID | Vulnerability | Component | Payload/Method | Impact | Fix |
|----|---------------|-----------|----------------|--------|-----|
| M-001 | [issue] | [where] | [how to exploit] | [impact] | [fix] |

## üîê Security Headers Analysis

| Header | Status | Risk | Recommendation |
|--------|--------|------|----------------|
| [header] | Present/Missing | [level] | [action] |

## üìã REMEDIATION ROADMAP

### Immediate Actions (24 hours)
1. [Action with exact steps]

### Short-term (1 week)
1. [Action with exact steps]

### Long-term (1 month)
1. [Action with exact steps]

---
SCAN DATA TO ANALYZE:
EOFPROMPT

    FULL_PROMPT="${PROMPT}

TARGET: $TARGET
SCAN MODE: AI-Only Analysis

$ALL_RESULTS
"
    
    echo -e "${CYAN}üß† Sending scan results to AI model: ${MODEL}${NC}"
    echo -e "${YELLOW}‚è≥ AI Analysis in progress... This may take 1-3 minutes${NC}"
    echo ""
    
    # Call Ollama
    AI_RESPONSE=$(ollama run "$MODEL" "$FULL_PROMPT" 2>&1)
    AI_EXIT_CODE=$?
    
    if [ $AI_EXIT_CODE -ne 0 ]; then
        echo -e "${RED}‚ùå AI Analysis Failed!${NC}"
        echo -e "${YELLOW}Error details:${NC}"
        echo "$AI_RESPONSE" | head -20
        exit 1
    fi
    
    # Display results
    END_TIME=$(date +%s)
    TOTAL_TIME=$((END_TIME - START_TIME))
    MINUTES=$((TOTAL_TIME / 60))
    SECONDS=$((TOTAL_TIME % 60))
    
    echo -e "${GREEN}‚úì AI Analysis Complete!${NC}"
    echo ""
    echo -e "${YELLOW}‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ${NC}"
    echo ""
    echo "$AI_RESPONSE"
    echo ""
    echo -e "${YELLOW}‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ${NC}"
    echo ""
    
    # Save report
    REPORT_FILE="$HOME/aiscan_aionly_${TARGET}_$(date +%Y%m%d_%H%M%S).txt"
    {
        echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
        echo "               AIScan Security Assessment Report            "
        echo "                       (AI-Only Mode)                        "
        echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
        echo ""
        echo "Target:       $TARGET"
        echo "Date:         $(date)"
        echo "AI Model:     $MODEL"
        echo "Analysis Time: ${MINUTES}m ${SECONDS}s"
        echo "Source File:  $AI_ONLY_FILE"
        echo ""
        echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
        echo "                      AI ANALYSIS REPORT                     "
        echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
        echo ""
        echo "$AI_RESPONSE"
        echo ""
        echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
        echo "                         END OF REPORT                       "
        echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
    } > "$REPORT_FILE"
    
    echo -e "${GREEN}‚úÖ AI analysis report saved to: ${REPORT_FILE}${NC}"
    echo -e "${GREEN}Scan completed successfully! (AI-only mode)${NC}"
    echo ""
    exit 0
fi

check_dependencies

echo -e "${BOLD}${RED}üéØ Target: ${NC}${TARGET}"
if [ "$AILESS_MODE" = true ]; then
    echo -e "${RED}ü§ñ AI Analysis: ${NC}${YELLOW}DISABLED (AI-less mode)${NC}"
else
    echo -e "${RED}ü§ñ AI Model: ${NC}${MODEL}"
fi
echo -e "${RED}‚ö° Scan Mode: ${NC}$([ "$QUICK_SCAN" = true ] && echo "Quick" || ([ "$FULL_SCAN" = true ] && echo "FULL AGGRESSIVE" || echo "Standard Aggressive"))"
echo -e "${RED}üìÅ Temp Directory: ${NC}${TEMP_DIR}"
echo ""
echo -e "${YELLOW}‚ö†Ô∏è  WARNING: Aggressive scanning mode enabled!${NC}"
echo -e "${YELLOW}‚ö†Ô∏è  This will generate significant traffic and logs.${NC}"
echo -e "${YELLOW}‚ö†Ô∏è  Only use on authorized targets!${NC}"
echo ""
echo -e "${CYAN}üí° TIP: Press 's' during any scan to skip it if it's taking too long${NC}"
echo -e "${CYAN}üìä Progress will be shown for each scan${NC}"
echo ""
echo -e "${YELLOW}‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ${NC}"
echo ""

# Start timestamp
START_TIME=$(date +%s)

# Initialize results
ALL_RESULTS=""
SCAN_COUNT=0
TOTAL_SCANS=15

# Function to run scan with skip option and progress indicator
run_scan() {
    local name=$1
    local command=$2
    local output_file=$3
    
    SCAN_COUNT=$((SCAN_COUNT + 1))
    echo -e "${MAGENTA}[$SCAN_COUNT/$TOTAL_SCANS]${NC} ${BOLD}$name${NC}"
    echo -e "${CYAN}Press 's' to skip...${NC}"
    
    # Run command in background
    eval "$command" > "$output_file" 2>&1 &
    local cmd_pid=$!
    
    # Progress indicator
    local spin='-\|/'
    local i=0
    local elapsed=0
    local skipped=false
    
    while kill -0 $cmd_pid 2>/dev/null; do
        # Show spinner and elapsed time
        printf "\r${BLUE}[${spin:i++%${#spin}:1}]${NC} Running... ${elapsed}s "
        
        # Check for 's' key press with timeout
        read -t 0.5 -n 1 key 2>/dev/null
        if [[ $key == "s" ]] || [[ $key == "S" ]]; then
            printf "\r${YELLOW}‚è≠ Skipping...                    ${NC}\n"
            kill -9 $cmd_pid 2>/dev/null
            wait $cmd_pid 2>/dev/null
            skipped=true
            break
        fi
        elapsed=$((elapsed + 1))
    done
    
    wait $cmd_pid 2>/dev/null
    local exit_code=$?
    
    if [ "$skipped" = true ]; then
        echo -e "${YELLOW}‚ö† Skipped by user${NC}"
        return 1
    elif [ $exit_code -eq 0 ] && [ -s "$output_file" ]; then
        printf "\r${GREEN}‚úì Complete (${elapsed}s)                    ${NC}\n"
        return 0
    else
        printf "\r${YELLOW}‚ö† Failed or no results (${elapsed}s)        ${NC}\n"
        return 1
    fi
}

# Set default URL if not specified
if [ -z "$SPECIFIC_URL" ]; then
    SPECIFIC_URL="http://$TARGET"
fi

# 1. Aggressive Nmap Scan
NMAP_OUT="$TEMP_DIR/nmap.txt"
if [ "$QUICK_SCAN" = true ]; then
    run_scan "Running Nmap (Quick Aggressive Scan)..." \
             "nmap -T4 -F --script vuln '$TARGET'" \
             "$NMAP_OUT"
elif [ "$FULL_SCAN" = true ]; then
    run_scan "Running Nmap (FULL AGGRESSIVE - All Ports + Scripts)..." \
             "nmap -T4 -p- -sV -sC --script='vuln,exploit,auth,brute' '$TARGET'" \
             "$NMAP_OUT"
else
    run_scan "Running Nmap (Aggressive Service Detection)..." \
             "nmap -T4 -sV -sC --script vuln -A '$TARGET'" \
             "$NMAP_OUT"
fi
if [ $? -eq 0 ]; then
    ALL_RESULTS+="=== NMAP AGGRESSIVE SCAN ===\n"
    ALL_RESULTS+="$(cat $NMAP_OUT)\n\n"
fi
echo ""

# 2. WhatWeb Aggressive
if command -v whatweb &> /dev/null; then
    WHATWEB_OUT="$TEMP_DIR/whatweb.txt"
    run_scan "Running WhatWeb (Aggressive Mode)..." \
             "whatweb -v -a 3 '$TARGET' 2>/dev/null" \
             "$WHATWEB_OUT"
    if [ $? -eq 0 ]; then
        ALL_RESULTS+="=== WHATWEB AGGRESSIVE FINGERPRINTING ===\n"
        ALL_RESULTS+="$(cat $WHATWEB_OUT)\n\n"
    fi
    echo ""
fi

# 3. Nikto Aggressive
if command -v nikto &> /dev/null; then
    NIKTO_OUT="$TEMP_DIR/nikto.txt"
    if [ "$QUICK_SCAN" = true ]; then
        run_scan "Running Nikto (Quick Vuln Scan)..." \
                 "timeout 180 nikto -h '$TARGET' -Tuning x" \
                 "$NIKTO_OUT"
    else
        run_scan "Running Nikto (Full Aggressive Vulnerability Scan)..." \
                 "timeout 600 nikto -h '$TARGET' -Tuning 123456789abc -C all" \
                 "$NIKTO_OUT"
    fi
    if [ -s "$NIKTO_OUT" ]; then
        ALL_RESULTS+="=== NIKTO AGGRESSIVE VULNERABILITY SCAN ===\n"
        ALL_RESULTS+="$(cat $NIKTO_OUT)\n\n"
    fi
    echo ""
fi

# 4. SQL Injection Testing with SQLMap (AGGRESSIVE)
if command -v sqlmap &> /dev/null; then
    SQLMAP_OUT="$TEMP_DIR/sqlmap.txt"
    if [ "$QUICK_SCAN" = true ]; then
        run_scan "Running SQLMap (Quick SQL Injection Test)..." \
                 "timeout 180 sqlmap -u '$SPECIFIC_URL' --batch --level=2 --risk=2 --threads=5 --random-agent" \
                 "$SQLMAP_OUT"
    elif [ "$FULL_SCAN" = true ]; then
        run_scan "Running SQLMap (FULL AGGRESSIVE - Deep SQL Injection)..." \
                 "timeout 900 sqlmap -u '$SPECIFIC_URL' --batch --crawl=3 --level=5 --risk=3 --threads=10 --tamper=space2comment --random-agent --technique=BEUSTQ" \
                 "$SQLMAP_OUT"
    else
        run_scan "Running SQLMap (Aggressive SQL Injection Test)..." \
                 "timeout 300 sqlmap -u '$SPECIFIC_URL' --batch --crawl=2 --level=3 --risk=2 --threads=5 --random-agent" \
                 "$SQLMAP_OUT"
    fi
    if [ -s "$SQLMAP_OUT" ]; then
        ALL_RESULTS+="=== SQLMAP SQL INJECTION TESTING ===\n"
        ALL_RESULTS+="$(cat $SQLMAP_OUT)\n\n"
    fi
    echo ""
fi

# 5. Command Injection with Commix
if command -v commix &> /dev/null && [ "$FULL_SCAN" = true ]; then
    COMMIX_OUT="$TEMP_DIR/commix.txt"
    run_scan "Running Commix (Command Injection Testing)..." \
             "timeout 300 commix -u '$SPECIFIC_URL' --batch --level=3 --random-agent" \
             "$COMMIX_OUT"
    if [ -s "$COMMIX_OUT" ]; then
        ALL_RESULTS+="=== COMMIX COMMAND INJECTION TESTING ===\n"
        ALL_RESULTS+="$(cat $COMMIX_OUT)\n\n"
    fi
    echo ""
fi

# 6. XSS Testing with XSStrike
if command -v xsstrike &> /dev/null && [ "$FULL_SCAN" = true ]; then
    XSS_OUT="$TEMP_DIR/xss.txt"
    run_scan "Running XSStrike (XSS Vulnerability Scanner)..." \
             "timeout 300 xsstrike -u '$SPECIFIC_URL' --crawl --fuzzer" \
             "$XSS_OUT"
    if [ -s "$XSS_OUT" ]; then
        ALL_RESULTS+="=== XSSTRIKE XSS VULNERABILITY TESTING ===\n"
        ALL_RESULTS+="$(cat $XSS_OUT)\n\n"
    fi
    echo ""
fi

# 7. Nuclei - Template based scanning
if command -v nuclei &> /dev/null; then
    NUCLEI_OUT="$TEMP_DIR/nuclei.txt"
    if [ "$QUICK_SCAN" = true ]; then
        run_scan "Running Nuclei (Critical Templates)..." \
                 "timeout 180 nuclei -u '$SPECIFIC_URL' -t ~/nuclei-templates/cves/ -silent" \
                 "$NUCLEI_OUT"
    else
        run_scan "Running Nuclei (Template-based Vulnerability Scanner)..." \
                 "timeout 600 nuclei -u '$SPECIFIC_URL' -t ~/nuclei-templates/ -severity critical,high,medium -silent" \
                 "$NUCLEI_OUT"
    fi
    if [ -s "$NUCLEI_OUT" ]; then
        ALL_RESULTS+="=== NUCLEI TEMPLATE-BASED SCANNING ===\n"
        ALL_RESULTS+="$(cat $NUCLEI_OUT)\n\n"
    fi
    echo ""
fi

# 8. Directory Brute Force
if [ "$FULL_SCAN" = true ]; then
    if command -v ffuf &> /dev/null; then
        FFUF_OUT="$TEMP_DIR/ffuf.txt"
        run_scan "Running FFUF (Fast Directory Brute Force)..." \
                 "timeout 300 ffuf -u '$SPECIFIC_URL/FUZZ' -w /usr/share/wordlists/dirb/common.txt -mc 200,301,302,403 -t 50 -s" \
                 "$FFUF_OUT"
        if [ -s "$FFUF_OUT" ]; then
            ALL_RESULTS+="=== FFUF DIRECTORY ENUMERATION ===\n"
            ALL_RESULTS+="$(cat $FFUF_OUT)\n\n"
        fi
        echo ""
    elif command -v gobuster &> /dev/null; then
        GOBUSTER_OUT="$TEMP_DIR/gobuster.txt"
        run_scan "Running Gobuster (Directory Enumeration)..." \
                 "timeout 300 gobuster dir -u '$SPECIFIC_URL' -w /usr/share/wordlists/dirb/common.txt -t 50 -q" \
                 "$GOBUSTER_OUT"
        if [ -s "$GOBUSTER_OUT" ]; then
            ALL_RESULTS+="=== GOBUSTER DIRECTORY ENUMERATION ===\n"
            ALL_RESULTS+="$(cat $GOBUSTER_OUT)\n\n"
        fi
        echo ""
    fi
fi

# 9. SSL/TLS Deep Analysis
if command -v testssl.sh &> /dev/null; then
    TESTSSL_OUT="$TEMP_DIR/testssl.txt"
    run_scan "Running TestSSL (Deep SSL/TLS Analysis)..." \
             "timeout 120 testssl.sh --fast --severity HIGH '$TARGET'" \
             "$TESTSSL_OUT"
    if [ -s "$TESTSSL_OUT" ]; then
        ALL_RESULTS+="=== TESTSSL DEEP SSL/TLS ANALYSIS ===\n"
        ALL_RESULTS+="$(cat $TESTSSL_OUT)\n\n"
    fi
    echo ""
else
    SSL_OUT="$TEMP_DIR/ssl.txt"
    run_scan "Checking SSL/TLS Certificate..." \
             "echo | openssl s_client -connect '$TARGET:443' -servername '$TARGET' 2>/dev/null | openssl x509 -noout -text" \
             "$SSL_OUT"
    if [ -s "$SSL_OUT" ]; then
        ALL_RESULTS+="=== SSL/TLS CERTIFICATE ===\n"
        ALL_RESULTS+="$(cat $SSL_OUT)\n\n"
    fi
    echo ""
fi

# 10. WAF Detection
if command -v wafw00f &> /dev/null; then
    WAF_OUT="$TEMP_DIR/waf.txt"
    run_scan "Running Wafw00f (WAF Detection & Bypass Analysis)..." \
             "wafw00f 'https://$TARGET' -a" \
             "$WAF_OUT"
    if [ $? -eq 0 ]; then
        ALL_RESULTS+="=== WAF DETECTION & ANALYSIS ===\n"
        ALL_RESULTS+="$(cat $WAF_OUT)\n\n"
    fi
    echo ""
fi

# 11. HTTP Headers Analysis
HEADERS_OUT="$TEMP_DIR/headers.txt"
run_scan "Analyzing HTTP Security Headers..." \
         "curl -sI 'http://$TARGET' && curl -sI 'https://$TARGET'" \
         "$HEADERS_OUT"
if [ $? -eq 0 ]; then
    ALL_RESULTS+="=== HTTP SECURITY HEADERS ===\n"
    ALL_RESULTS+="$(cat $HEADERS_OUT)\n\n"
fi
echo ""

# 12. DNS Enumeration
DNS_OUT="$TEMP_DIR/dns.txt"
run_scan "DNS Information Gathering..." \
         "host '$TARGET' && dig '$TARGET' ANY +noall +answer && dig '$TARGET' AXFR" \
         "$DNS_OUT"
if [ -s "$DNS_OUT" ]; then
    ALL_RESULTS+="=== DNS INFORMATION & ENUMERATION ===\n"
    ALL_RESULTS+="$(cat $DNS_OUT)\n\n"
fi
echo ""

# 13. Subdomain Enumeration (Full scan only)
if [ "$FULL_SCAN" = true ] && command -v subfinder &> /dev/null; then
    SUBDOMAIN_OUT="$TEMP_DIR/subdomains.txt"
    run_scan "Running Subfinder (Subdomain Enumeration)..." \
             "timeout 120 subfinder -d '$TARGET' -silent" \
             "$SUBDOMAIN_OUT"
    if [ -s "$SUBDOMAIN_OUT" ]; then
        ALL_RESULTS+="=== SUBDOMAIN ENUMERATION ===\n"
        ALL_RESULTS+="$(cat $SUBDOMAIN_OUT)\n\n"
    fi
    echo ""
fi

# 14. Robots.txt and Sitemap Analysis
ROBOTS_OUT="$TEMP_DIR/robots.txt"
run_scan "Analyzing robots.txt and sitemap..." \
         "curl -s 'http://$TARGET/robots.txt' && curl -s 'http://$TARGET/sitemap.xml'" \
         "$ROBOTS_OUT"
if [ -s "$ROBOTS_OUT" ]; then
    ALL_RESULTS+="=== ROBOTS.TXT & SITEMAP ANALYSIS ===\n"
    ALL_RESULTS+="$(cat $ROBOTS_OUT)\n\n"
fi
echo ""

# 15. JavaScript Analysis (Full scan)
if [ "$FULL_SCAN" = true ]; then
    JS_OUT="$TEMP_DIR/javascript.txt"
    run_scan "Extracting and Analyzing JavaScript Files..." \
             "curl -s '$SPECIFIC_URL' | grep -oP 'src=\"\K[^\"]*\.js' | head -10 | xargs -I {} curl -s '{}'" \
             "$JS_OUT"
    if [ -s "$JS_OUT" ]; then
        ALL_RESULTS+="=== JAVASCRIPT ANALYSIS ===\n"
        ALL_RESULTS+="$(cat $JS_OUT | head -100)\n\n"
    fi
    echo ""
fi

# Calculate total scan time
END_TIME=$(date +%s)
TOTAL_TIME=$((END_TIME - START_TIME))
MINUTES=$((TOTAL_TIME / 60))
SECONDS=$((TOTAL_TIME % 60))

echo -e "${YELLOW}‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ${NC}"
echo ""
echo -e "${BOLD}${RED}üìä AGGRESSIVE SCAN RESULTS SUMMARY${NC}"
echo -e "${RED}‚è±Ô∏è  Total scan time: ${MINUTES}m ${SECONDS}s${NC}"
echo ""
echo -e "${YELLOW}‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ${NC}"
echo ""

# Display key findings from each tool
RESULTS_FOUND=false
for tool_file in "$TEMP_DIR"/*.txt; do
    if [ -f "$tool_file" ] && [ -s "$tool_file" ]; then
        RESULTS_FOUND=true
        tool_name=$(basename "$tool_file" .txt)
        echo -e "${CYAN}${BOLD}‚îÅ‚îÅ‚îÅ ${tool_name^^} ‚îÅ‚îÅ‚îÅ${NC}"
        
        # Smart preview - show most relevant lines
        case "$tool_name" in
            nmap)
                grep -E "open|filtered|PORT|SERVICE|VERSION|VULN" "$tool_file" | head -20
                ;;
            nikto)
                grep -E "^\+|OSVDB|CVE|INJECTION|XSS" "$tool_file" | head -25
                ;;
            sqlmap)
                grep -iE "vulnerable|injection|parameter|payload|database" "$tool_file" | head -30
                ;;
            commix)
                grep -iE "vulnerable|injection|command|shell" "$tool_file" | head -20
                ;;
            xss)
                grep -iE "vulnerable|XSS|payload|reflected" "$tool_file" | head -20
                ;;
            nuclei)
                cat "$tool_file" | head -30
                ;;
            headers)
                grep -iE "Server:|X-|Content-Security|Strict-Transport|Missing" "$tool_file" | head -15
                ;;
            ssl|testssl)
                grep -iE "VULNERABLE|CRITICAL|HIGH|Certificate|TLS" "$tool_file" | head -15
                ;;
            *)
                head -25 "$tool_file"
                ;;
        esac
        echo ""
    fi
done

if [ "$RESULTS_FOUND" = false ]; then
    echo -e "${RED}‚ö†Ô∏è  No scan results collected. All scans may have failed or been skipped.${NC}"
    echo -e "${YELLOW}Try running again with --quick mode or check network connectivity.${NC}"
    echo ""
fi

echo -e "${YELLOW}‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ${NC}"
echo ""

# AI Analysis or Skip
if [ "$AILESS_MODE" = true ]; then
    echo -e "${BOLD}${YELLOW}üö´ AI Analysis Skipped (AI-less mode)${NC}"
    echo ""
    echo -e "${CYAN}üìã Raw scan results have been collected and displayed above.${NC}"
    echo -e "${CYAN}üí° To enable AI analysis, run without --no-ai flag${NC}"
    echo ""
    
    # Save report without AI analysis
    REPORT_FILE="$HOME/aiscan_report_${TARGET}_$(date +%Y%m%d_%H%M%S).txt"
    {
        echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
        echo "               AIScan Security Assessment Report            "
        echo "                         (AI-less Mode)                      "
        echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
        echo ""
        echo "Target:     $TARGET"
        echo "Date:       $(date)"
        echo "AI Analysis: DISABLED"
        echo "Scan Time:  ${MINUTES}m ${SECONDS}s"
        echo "Scan Mode:  $([ "$QUICK_SCAN" = true ] && echo "Quick" || ([ "$FULL_SCAN" = true ] && echo "Full Aggressive" || echo "Standard Aggressive"))"
        echo ""
        echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
        echo "                        SCAN RESULTS                         "
        echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
        echo ""
        echo -e "$ALL_RESULTS"
        echo ""
        echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
        echo "                         END OF REPORT                       "
        echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
        echo ""
        echo "NOTE: This report was generated in AI-less mode."
        echo "For detailed AI-powered vulnerability analysis and exploitation"
        echo "guidance, run the scan again without the --no-ai flag."
    } > "$REPORT_FILE"
    
    echo -e "${GREEN}‚úÖ Full report saved to: ${REPORT_FILE}${NC}"
    echo -e "${CYAN}üìÅ Temp scan files: $TEMP_DIR (will be cleaned up on exit)${NC}"
    echo ""
    echo -e "${GREEN}Scan completed successfully! (AI-less mode)${NC}"
    echo ""
    exit 0
fi

# Handle External AI mode
if [ -n "$EXTERNAL_AI_FILE" ]; then
    echo -e "${BOLD}${MAGENTA}üåê EXTERNAL AI MODE${NC}"
    echo ""
    
    EXTERNAL_AI_RESPONSE=""
    
    if [ "$EXTERNAL_AI_FILE" = "-" ]; then
        echo -e "${CYAN}üìù Paste your AI analysis below (press Ctrl+D when done):${NC}"
        echo -e "${YELLOW}‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ${NC}"
        EXTERNAL_AI_RESPONSE=$(cat)
        echo ""
        echo -e "${YELLOW}‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ${NC}"
    else
        if [ ! -f "$EXTERNAL_AI_FILE" ]; then
            echo -e "${RED}‚ùå Error: File not found: $EXTERNAL_AI_FILE${NC}"
            exit 1
        fi
        EXTERNAL_AI_RESPONSE=$(cat "$EXTERNAL_AI_FILE")
        echo -e "${GREEN}‚úì Loaded external AI analysis from: $EXTERNAL_AI_FILE${NC}"
    fi
    
    echo ""
    echo -e "${GREEN}‚úì External AI Analysis Loaded!${NC}"
    echo -e "${CYAN}üìä Analysis size: $(echo -e "$EXTERNAL_AI_RESPONSE" | wc -c) bytes${NC}"
    echo ""
    echo -e "${YELLOW}‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ${NC}"
    echo ""
    echo "$EXTERNAL_AI_RESPONSE"
    echo ""
    echo -e "${YELLOW}‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ${NC}"
    echo ""
    
    # Save full report with external AI
    REPORT_FILE="$HOME/aiscan_report_${TARGET}_$(date +%Y%m%d_%H%M%S).txt"
    {
        echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
        echo "               AIScan Security Assessment Report            "
        echo "                    (External AI Analysis)                   "
        echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
        echo ""
        echo "Target:     $TARGET"
        echo "Date:       $(date)"
        echo "AI Source:  External (ChatGPT/Claude/Gemini/etc.)"
        echo "Scan Time:  ${MINUTES}m ${SECONDS}s"
        echo "Scan Mode:  $([ "$QUICK_SCAN" = true ] && echo "Quick" || ([ "$FULL_SCAN" = true ] && echo "Full Aggressive" || echo "Standard Aggressive"))"
        echo ""
        echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
        echo "                        SCAN RESULTS                         "
        echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
        echo ""
        echo -e "$ALL_RESULTS"
        echo ""
        echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
        echo "                 EXTERNAL AI ANALYSIS REPORT                 "
        echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
        echo ""
        echo "$EXTERNAL_AI_RESPONSE"
        echo ""
        echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
        echo "                         END OF REPORT                       "
        echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
    } > "$REPORT_FILE"
    
    echo -e "${GREEN}‚úÖ Full report saved to: ${REPORT_FILE}${NC}"
    echo -e "${CYAN}üìÅ Temp scan files: $TEMP_DIR (will be cleaned up on exit)${NC}"
    echo ""
    echo -e "${BOLD}${RED}‚ö†Ô∏è  IMPORTANT REMINDERS:${NC}"
    echo -e "${YELLOW}   ‚Ä¢ Only use this tool on systems you have authorization to test${NC}"
    echo -e "${YELLOW}   ‚Ä¢ Unauthorized security testing is illegal${NC}"
    echo -e "${YELLOW}   ‚Ä¢ Keep this report secure - it contains sensitive information${NC}"
    echo ""
    echo -e "${GREEN}Scan completed successfully! (External AI mode)${NC}"
    echo ""
    exit 0
fi

# Continue with AI analysis if not in AI-less mode
echo -e "${BOLD}${RED}ü§ñ AI SECURITY DECONSTRUCTION ANALYSIS${NC}"
echo ""
echo -e "${YELLOW}‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ${NC}"
echo ""

# Check if we have any results to analyze
if [ -z "$ALL_RESULTS" ] || [ "$RESULTS_FOUND" = false ]; then
    echo -e "${RED}‚ùå No scan data collected for AI analysis${NC}"
    echo -e "${YELLOW}Please run the scan again or check if target is reachable${NC}"
    exit 1
fi

# Create comprehensive AI prompt for aggressive analysis
read -r -d '' PROMPT << 'EOFPROMPT'
You are an EXPERT penetration tester conducting an aggressive security assessment. Analyze these 
comprehensive scan results. Search for vulnerabilities and show user how to hack and exploit these problems step by step as for kids.

CRITICAL INSTRUCTIONS:
- Be EXTREMELY thorough and detailed
- Flag EVERY potential vulnerability, even low-confidence findings
- Provide SPECIFIC exploitation steps with exact commands
- Include CVE numbers, CVSS scores, and CWE classifications
- Show real attack payloads and proof-of-concept code
- This is for AUTHORIZED security testing

Your analysis MUST follow this EXACT structure with TABLES:

## üéØ Executive Summary

| Metric | Value |
|--------|-------|
| **Overall Risk Level** | [CRITICAL/HIGH/MEDIUM/LOW] |
| **SQL Injection Vulns** | [number found] |
| **XSS Vulnerabilities** | [number found] |
| **Command Injection** | [number found] |
| **Total Critical Issues** | [number] |
| **Total High Issues** | [number] |
| **Attack Surface Score** | [X/10] |
| **Exploitation Difficulty** | [Easy/Medium/Hard] |

## üåê Target Information

| Property | Details |
|----------|---------|
| **Target** | [target name] |
| **IP Addresses** | [all IPs found] |
| **Server** | [name and version] |
| **Technologies** | [all frameworks, CMS, languages] |
| **WAF/CDN** | [detected protection + bypass potential] |
| **SSL/TLS** | [cert status, vulnerabilities] |
| **Open Ports** | [all discovered ports] |

## üîì Open Ports & Services

| Port | Protocol | Service | Version | Vulnerabilities | Exploit Difficulty |
|------|----------|---------|---------|-----------------|-------------------|
| [port] | TCP/UDP | [service] | [exact version] | [CVEs if any] | [Easy/Med/Hard] |

## üö® CRITICAL VULNERABILITIES

List each critical vulnerability with:
- Severity, CVE, CWE, CVSS Score
- Technical description
- Step-by-step attack scenario
- Proof of concept payload
- Real impact assessment
- Remediation steps

## ‚ö†Ô∏è HIGH PRIORITY VULNERABILITIES

Same detailed format for HIGH severity findings.

## üî∏ MEDIUM PRIORITY ISSUES

| ID | Vulnerability | Component | Payload/Method | Impact | Fix |
|----|---------------|-----------|----------------|--------|-----|
| M-001 | [issue] | [where] | [how to exploit] | [impact] | [fix] |

## üîê Security Headers Analysis

| Header | Status | Risk | Recommendation |
|--------|--------|------|----------------|
| [header] | Present/Missing | [level] | [action] |

## üìã REMEDIATION ROADMAP

### Immediate Actions (24 hours)
1. [Action with exact steps]

### Short-term (1 week)
1. [Action with exact steps]

### Long-term (1 month)
1. [Action with exact steps]

---
SCAN DATA TO ANALYZE:
EOFPROMPT

# Append scan results to prompt
FULL_PROMPT="${PROMPT}

TARGET: $TARGET
SCAN MODE: $([ "$QUICK_SCAN" = true ] && echo "Quick" || ([ "$FULL_SCAN" = true ] && echo "Full Aggressive" || echo "Standard"))

$ALL_RESULTS
"

# Save prompt to file for debugging
echo -e "$FULL_PROMPT" > "$TEMP_DIR/ai_prompt.txt"

echo -e "${CYAN}üß† Sending scan results to AI model: ${MODEL}${NC}"
echo -e "${CYAN}üìä Data size: $(echo -e "$ALL_RESULTS" | wc -c) bytes${NC}"
echo ""
echo -e "${YELLOW}‚è≥ AI Analysis in progress... This may take 1-3 minutes${NC}"
echo ""

# Call Ollama API with the comprehensive prompt
AI_RESPONSE=$(ollama run "$MODEL" "$FULL_PROMPT" 2>&1)
AI_EXIT_CODE=$?

# Check if AI analysis was successful
if [ $AI_EXIT_CODE -ne 0 ]; then
    echo -e "${RED}‚ùå AI Analysis Failed!${NC}"
    echo -e "${YELLOW}Error details:${NC}"
    echo "$AI_RESPONSE" | head -20
    echo ""
    echo -e "${YELLOW}Troubleshooting:${NC}"
    echo "1. Check if model is available: ollama list"
    echo "2. Pull the model if needed: ollama pull $MODEL"
    echo "3. Try a different model with: $0 $TARGET -m llama3.2"
    echo "4. Check ollama service: systemctl status ollama (if using systemd)"
    echo "5. Or run in AI-less mode: $0 $TARGET --no-ai"
    echo ""
    echo -e "${CYAN}üí° Your scan results are saved in: $TEMP_DIR/${NC}"
    echo -e "${CYAN}üí° AI prompt saved to: $TEMP_DIR/ai_prompt.txt${NC}"
    exit 1
fi

# Display AI Analysis
echo -e "${GREEN}‚úì AI Analysis Complete!${NC}"
echo ""
echo -e "${YELLOW}‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ${NC}"
echo ""
echo "$AI_RESPONSE"
echo ""
echo -e "${YELLOW}‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ${NC}"
echo ""

# Save full report
REPORT_FILE="$HOME/aiscan_report_${TARGET}_$(date +%Y%m%d_%H%M%S).txt"
{
    echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
    echo "               AIScan Security Assessment Report            "
    echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
    echo ""
    echo "Target:     $TARGET"
    echo "Date:       $(date)"
    echo "AI Model:   $MODEL"
    echo "Scan Time:  ${MINUTES}m ${SECONDS}s"
    echo "Scan Mode:  $([ "$QUICK_SCAN" = true ] && echo "Quick" || ([ "$FULL_SCAN" = true ] && echo "Full Aggressive" || echo "Standard Aggressive"))"
    echo ""
    echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
    echo "                        SCAN RESULTS                         "
    echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
    echo ""
    echo -e "$ALL_RESULTS"
    echo ""
    echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
    echo "                      AI ANALYSIS REPORT                     "
    echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
    echo ""
    echo "$AI_RESPONSE"
    echo ""
    echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
    echo "                         END OF REPORT                       "
    echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
} > "$REPORT_FILE"

echo -e "${GREEN}‚úÖ Full report saved to: ${REPORT_FILE}${NC}"
echo -e "${CYAN}üìÅ Temp scan files: $TEMP_DIR (will be cleaned up on exit)${NC}"
echo ""
echo -e "${BOLD}${RED}‚ö†Ô∏è  IMPORTANT REMINDERS:${NC}"
echo -e "${YELLOW}   ‚Ä¢ Only use this tool on systems you have authorization to test${NC}"
echo -e "${YELLOW}   ‚Ä¢ Unauthorized security testing is illegal${NC}"
echo -e "${YELLOW}   ‚Ä¢ Keep this report secure - it contains sensitive information${NC}"
echo ""
echo -e "${GREEN}Scan completed successfully!${NC}"
echo ""
